# SIP PBX - 설정 파일 예시
# 이 파일을 config.yaml로 복사하여 사용하세요: cp config.example.yaml config.yaml

# =============================================================================
# SIP 서버 설정
# =============================================================================
sip:
  # SIP 서버가 리스닝할 IP 주소 (0.0.0.0 = 모든 인터페이스)
  listen_ip: "0.0.0.0"
  
  # SIP 서버 포트 (기본: 5060)
  listen_port: 5060
  
  # 전송 프로토콜: udp, tcp, tls
  transport: "udp"
  
  # 최대 동시 통화 수 (1-1000)
  max_concurrent_calls: 100

# =============================================================================
# 미디어 처리 설정
# =============================================================================
media:
  # 미디어 처리 모드
  # - bypass: RTP 패킷을 그대로 relay (저지연)
  mode: "bypass"
  
  # RTP/RTCP 포트 풀 설정
  port_pool:
    start: 10000  # 시작 포트
    end: 20000    # 종료 포트 (10,000개 포트 → 1,250개 동시 호 지원)
  
  # RTP 타임아웃 (초): 이 시간 동안 RTP 수신 없으면 자동 종료
  rtp_timeout: 60
  
  # 코덱 우선순위 (SDP negotiation 시 선호도 순서)
  codec_priority:
    - "opus"   # 고품질, 저대역폭
    - "pcmu"   # G.711 μ-law
    - "pcma"   # G.711 A-law

# =============================================================================
# 이벤트 및 알림 설정
# =============================================================================
events:
  # Webhook URL 리스트 (이벤트 발생 시 POST 전송)
  webhook_urls:
    - "http://your-service.com/webhook"
    # - "http://backup-service.com/webhook"
  
  # Webhook 타임아웃 (초)
  webhook_timeout: 10
  
  # Webhook 실패 시 재시도 횟수
  webhook_retries: 3


# =============================================================================
# CDR (Call Detail Record) 설정
# =============================================================================
cdr:
  # CDR 기록 활성화
  enabled: true
  
  # CDR 출력 디렉토리
  output_dir: "/var/log/sip-pbx/cdr"
  
  # 파일명 패턴 (strftime 포맷)
  filename_pattern: "cdr-%Y-%m-%d.jsonl"
  
  # 로테이션 주기: daily, hourly
  rotation: "daily"
  
  # 보관 기간 (일)
  retention_days: 90

# =============================================================================
# 로깅 설정
# =============================================================================
logging:
  # 로그 레벨: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: "INFO"
  
  # 로그 포맷: json (구조화), text (사람이 읽기 쉬운)
  format: "json"
  
  # 로그 출력: stdout (컨테이너 환경), file (파일)
  output: "stdout"
  
  # 파일 출력 시 경로
  file_path: "/var/log/sip-pbx/app.log"
  
  # 로그 파일 최대 크기 (바이트)
  max_bytes: 104857600  # 100MB
  
  # 백업 파일 수
  backup_count: 10

# =============================================================================
# 모니터링 설정
# =============================================================================
monitoring:
  # Prometheus 메트릭 포트
  prometheus_port: 9090
  
  # 메트릭 경로
  prometheus_path: "/metrics"
  
  # 헬스체크 HTTP 포트
  health_check_port: 8080
  
  # 헬스체크 간격 (초)
  health_check_interval: 10

# =============================================================================
# 보안 설정
# =============================================================================
security:
  # Admin API 인증 키 (프로덕션 환경에서 반드시 변경!)
  admin_api_key: "CHANGE_ME_IN_PRODUCTION"
  
  # Webhook 서명 비밀 키
  webhook_secret: "CHANGE_ME_IN_PRODUCTION"
  
  # IP 화이트리스트
  ip_whitelist:
    enabled: false
    allowed_ips:
      - "10.0.0.0/8"
      - "172.16.0.0/12"
      - "192.168.0.0/16"

# =============================================================================
# 환경 변수로 오버라이드 가능
# 예: export SIP_PBX_SIP_LISTEN_PORT=5061
# =============================================================================


# SIP PBX with Real-time Voice Analysis - Configuration File

# SIP ì„œë²„ ì„¤ì •
sip:
  listen_ip: "0.0.0.0"
  listen_port: 5060
  transport: "udp"  # udp, tcp, tls
  max_concurrent_calls: 100

# ë¯¸ë””ì–´ ì²˜ë¦¬ ì„¤ì •
media:
  mode: "bypass"  # bypass | reflecting
  port_pool:
    start: 10000
    end: 20000
  rtp_timeout: 60  # seconds without RTP â†’ auto-terminate
  codec_priority:
    - "opus"
    - "pcmu"  # G.711 Î¼-law
    - "pcma"  # G.711 A-law

# AI ë¶„ì„ ì„¤ì • (ê¸°ì¡´ - í†µí™” ì¤‘ ë¶„ì„)
ai:
  enabled: true
  
  stt:
    model: "faster-whisper-large-v3"
    device: "cuda"  # cuda | cpu
    language: "auto"  # auto, ko, en
    beam_size: 5
    vad_filter: true
    
  emotion:
    model: "speechbrain/emotion-recognition"
    device: "cuda"
    threshold: 0.7  # 0.0 - 1.0
    sample_rate: 16000
    
  text_classifier:
    model_korean: "beomi/KcELECTRA-base"
    model_english: "distilbert-base-uncased"
    device: "cuda"
    threshold: 0.8  # 0.0 - 1.0
    
  profanity_dict:
    path: "config/profanity_dict.yaml"
    enabled: true

# =============================================================================
# AI ë³´ì´ìŠ¤ë´‡ ì„¤ì • (ì‹ ê·œ - ë¶€ì¬ì¤‘ ìë™ ì‘ë‹µ)
# =============================================================================
ai_voicebot:
  enabled: true  # AI ë³´ì´ìŠ¤ë´‡ í™œì„±í™” ì—¬ë¶€
  
  # ë¶€ì¬ì¤‘ ì„¤ì •
  no_answer_timeout: 10  # ì´ˆ (ì°©ì‹ ìê°€ ì´ ì‹œê°„ ë™ì•ˆ ì‘ë‹µ ì—†ìœ¼ë©´ AI í™œì„±í™”)
  
  # ê³ ì • ì¸ì‚¬ë§
  greeting_message: "ì•ˆë…•í•˜ì„¸ìš”, AI ë¹„ì„œì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦¤ê¹Œìš”?"
  
  # â­ Google Cloud ì„¤ì • - ì—¬ê¸°ì— API ì •ë³´ ì…ë ¥! â­
  google_cloud:
    project_id: "sip-pbx-ai"  # â† Google Cloud í”„ë¡œì íŠ¸ ID
    credentials_path: "config/gcp-key.json"  # â† Service Account í‚¤ íŒŒì¼ ê²½ë¡œ
    
    # Quota ê´€ë¦¬
    quota_management:
      daily_request_limit: 1000  # ì¼ì¼ ìš”ì²­ ì œí•œ
      cost_alert_threshold_usd: 50  # ë¹„ìš© ì•ŒëŒ ì„ê³„ê°’ (ë‹¬ëŸ¬)
      auto_throttle_enabled: true
    
    # STT (Speech-to-Text) ì„¤ì •
    stt:
      model: "telephony"  # telephony | latest_long
      language_code: "ko-KR"  # ko-KR | en-US
      sample_rate: 16000
      enable_enhanced: true
      enable_automatic_punctuation: true
    
    # TTS (Text-to-Speech) ì„¤ì •
    tts:
      voice_name: "ko-KR-Neural2-A"  # ì—¬ì„± ëª©ì†Œë¦¬ (A, B, C ì¤‘ ì„ íƒ)
      speaking_rate: 1.0  # 0.25 - 4.0 (1.0 = ë³´í†µ ì†ë„)
      pitch: 0.0  # -20.0 - 20.0 (0 = ë³´í†µ ìŒë†’ì´)
    
    # Gemini LLM ì„¤ì •
    gemini:
      # ğŸš€ ê¶Œì¥ ëª¨ë¸ (2026ë…„ 1ì›” ê¸°ì¤€):
      #   1. gemini-2.5-flash (ìµœì‹  ì•ˆì •íŒ, ê°€ì¥ ë¹ ë¥´ê³  ì €ë ´, ì…ë ¥ 100ë§Œ í† í°)
      #   2. gemini-flash-latest (í•­ìƒ ìµœì‹  Flash ë²„ì „ìœ¼ë¡œ ìë™ ì—…ë°ì´íŠ¸)
      #   3. gemini-2.0-flash (ì•ˆì •ì )
      #   4. gemini-2.5-flash-lite (ë” ë¹ ë¥´ê³  ì €ë ´, ê²½ëŸ‰ ì‘ë‹µìš©)
      # 
      # ğŸ’° ë¹„ìš© ë¹„êµ (100ë§Œ í† í°):
      #   - Flash 2.5: $0.075 (ì…ë ¥) / $0.30 (ì¶œë ¥) â†’ ì›” ~â‚©1,400 (100í†µ ê¸°ì¤€)
      #   - Pro 2.5:   $1.25 (ì…ë ¥) / $5.00 (ì¶œë ¥) â†’ ì›” ~â‚©23,400 (100í†µ ê¸°ì¤€)
      # âš¡ ì‘ë‹µ ì†ë„:
      #   - Flash 2.5: 300~600ms (ì§§ì€ ë‹µë³€, ìµœê³  ì†ë„)
      #   - Flash 2.0: 400~700ms (ì§§ì€ ë‹µë³€)
      #   - Pro 2.5:   800~1200ms (ì§§ì€ ë‹µë³€)
      # ğŸ“Š í’ˆì§ˆ: ê°„ë‹¨í•œ ëŒ€í™”(1~2ë¬¸ì¥)ì—ì„œëŠ” Flashì™€ Pro ì°¨ì´ ë¯¸ë¯¸
      model: "gemini-2.5-flash"  # gemini-2.5-flash (ìµœì‹ ) | gemini-flash-latest | gemini-2.0-flash | gemini-2.5-flash-lite
      
      # â­ Gemini API í‚¤ (í•„ìˆ˜)
      # ë°œê¸‰: https://aistudio.google.com/app/apikey
      api_key: "AIzaSyBhQpIGB4iCRxCE0k_g2DW4s4MYOO9Laac"
      
      temperature: 0.5  # 0.0 - 1.0 (ë‚®ì„ìˆ˜ë¡ ì¼ê´€ì ì´ê³  ë¹ ë¦„, 0.5 ê¶Œì¥)
      max_output_tokens: 150  # ìµœëŒ€ ì¶œë ¥ í† í° (1~2ë¬¸ì¥, 150 í† í° ê¶Œì¥)
      
      # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (ê°„ê²°í•œ ì‘ë‹µ ìœ ë„)
      system_prompt: |
        ë‹¹ì‹ ì€ ì „í™” ì‘ëŒ€ AI ë¹„ì„œì…ë‹ˆë‹¤.
        ê·œì¹™:
        1. 1~2ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ë‹µë³€í•˜ì„¸ìš”.
        2. ë¶ˆí•„ìš”í•œ ì¸ì‚¬ë§ì´ë‚˜ ë¶€ì—° ì„¤ëª…ì„ ìƒëµí•˜ì„¸ìš”.
        3. ì§ˆë¬¸ì˜ í•µì‹¬ë§Œ ëª…í™•í•˜ê²Œ ì „ë‹¬í•˜ì„¸ìš”.
        4. ëª¨ë¥´ëŠ” ë‚´ìš©ì€ ì†”ì§íˆ "ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤"ë¼ê³  ë‹µë³€í•˜ì„¸ìš”.
  
  # Resilience (ì¬ì‹œë„ ë° Circuit Breaker)
  resilience:
    retry:
      max_attempts: 3  # ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜
      backoff_multiplier: 2  # ë°±ì˜¤í”„ ë°°ìœ¨
      min_wait_seconds: 2  # ìµœì†Œ ëŒ€ê¸° ì‹œê°„
      max_wait_seconds: 10  # ìµœëŒ€ ëŒ€ê¸° ì‹œê°„
    
    circuit_breaker:
      failure_threshold: 5  # ì‹¤íŒ¨ ì„ê³„ê°’ (5íšŒ ì‹¤íŒ¨ ì‹œ open)
      timeout_seconds: 60  # Open ìƒíƒœ ìœ ì§€ ì‹œê°„
      half_open_max_calls: 3  # Half-open ìƒíƒœ í…ŒìŠ¤íŠ¸ í˜¸ì¶œ ìˆ˜
  
  # Vector DB ì„¤ì •
  vector_db:
    provider: "chromadb"  # chromadb | pinecone
    
    # ChromaDB (ê°œë°œ/ë¡œì»¬)
    chromadb:
      persist_directory: "./data/chromadb"
    
    # Pinecone (í”„ë¡œë•ì…˜) - ì‚¬ìš© ì‹œ ì£¼ì„ í•´ì œ
    # pinecone:
    #   api_key: "${PINECONE_API_KEY}"  # í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë¡œë“œ
    #   environment: "us-west1-gcp"
    #   index_name: "knowledge-base"
    #   dimension: 768  # Sentence Transformers ì°¨ì›
  
  # Embedding ì„¤ì •
  embedding:
    model: "paraphrase-multilingual-mpnet-base-v2"  # Sentence Transformers ëª¨ë¸
    dimension: 768
    batch_size: 32
  
  # RAG ì„¤ì •
  rag:
    top_k: 3  # ê²€ìƒ‰í•  ë¬¸ì„œ ìˆ˜
    similarity_threshold: 0.7  # ìœ ì‚¬ë„ ì„ê³„ê°’ (0.0 - 1.0)
    reranking_enabled: false  # ì¬ìˆœìœ„í™” í™œì„±í™”
  
  # ë…¹ìŒ ì„¤ì •
  recording:
    enabled: true
    output_dir: "./recordings"
    format: "wav"
    sample_rate: 16000
    
    # ì§€ì‹ ì¶”ì¶œ
    knowledge_extraction:
      enabled: true
      min_confidence: 0.7  # LLM íŒë‹¨ ìµœì†Œ ì‹ ë¢°ë„
      chunk_size: 500  # ë¬¸ì
      chunk_overlap: 50  # ë¬¸ì
  
  # VAD (Voice Activity Detection)
  vad:
    enabled: true
    mode: 3  # 0-3 (3ì´ ê°€ì¥ ë¯¼ê°)
    frame_duration_ms: 30  # 10 | 20 | 30
  
  # Barge-in ì„¤ì •
  barge_in:
    enabled: true
    vad_threshold: 0.5  # ìŒì„± ê°ì§€ ì„ê³„ê°’
    speech_frame_count: 3  # ì—°ì† ìŒì„± í”„ë ˆì„ ìˆ˜
  
  # ì˜¤ë””ì˜¤ ë²„í¼
  audio_buffer:
    jitter_buffer_ms: 60  # Jitter ë²„í¼ í¬ê¸°
    max_buffer_size: 100  # ìµœëŒ€ íŒ¨í‚· ìˆ˜
    target_sample_rate: 16000  # ëª©í‘œ ìƒ˜í”Œë ˆì´íŠ¸
  
  # ë¡œê¹…
  logging:
    log_conversations: true  # ëŒ€í™” ë‚´ìš© ë¡œê¹…
    log_audio: true  # ì˜¤ë””ì˜¤ ë°ì´í„° ë¡œê¹… (ë””ë²„ê·¸ìš©)
    log_level: "INFO"  # DEBUG | INFO | WARNING | ERROR

# ì´ë²¤íŠ¸ ë° ì•Œë¦¼ ì„¤ì •
events:
  webhook_urls:
    - "http://localhost:5000/webhook"
  webhook_timeout: 10  # seconds
  webhook_retries: 3
  
  thresholds:
    profanity: 0.8
    anger: 0.7
    threatening: 0.75
    combined_alert: true  # profanity + anger ë™ì‹œ ë°œìƒ ì‹œ ë†’ì€ ìš°ì„ ìˆœìœ„
  
  severity_levels:
    low: 0.5
    medium: 0.7
    high: 0.85
    critical: 0.95

# CDR (Call Detail Record) ì„¤ì •
cdr:
  enabled: true
  output_dir: "/var/log/sip-pbx/cdr"
  filename_pattern: "cdr-%Y-%m-%d.jsonl"
  rotation: "daily"  # daily, hourly
  retention_days: 90

# ë¡œê¹… ì„¤ì •
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "json"  # json, text
  output: "file"  # stdout, file
  file_path: "/var/log/sip-pbx/app.log"
  max_bytes: 104857600  # 100MB
  backup_count: 10

# ëª¨ë‹ˆí„°ë§ ì„¤ì •
monitoring:
  prometheus_port: 9090
  prometheus_path: "/metrics"
  health_check_port: 8080
  health_check_interval: 10  # seconds

# GPU ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
gpu:
  device_id: 0  # CUDA device ID
  memory_fraction: 0.9  # Max GPU memory to use (0.0 - 1.0)
  batch_size:
    stt: 4
    emotion: 8
    text_classifier: 16

# ë³´ì•ˆ ì„¤ì •
security:
  admin_api_key: "change-me-in-production"
  webhook_secret: "change-me-in-production"
  ip_whitelist:
    enabled: false
    allowed_ips:
      - "10.0.0.0/8"
      - "172.16.0.0/12"
      - "192.168.0.0/16"


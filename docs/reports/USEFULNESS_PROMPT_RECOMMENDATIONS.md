# 유용성 판단 프롬프트 개선 권장사항 (Usefulness Judgment Prompt)

## 배경

현재 시스템은 통화 내용에 대해 "유용성 판단 요청"으로 LLM을 호출하여, 지식 베이스(VectorDB)에 저장할 가치가 있는지 판단합니다.  
이 문서는 **고객/상담 대화에서 유용한 지식을 추출**하기 위한 업계·연구 권장사항과, 우리 프롬프트에 적용할 구체적 기준를 정리합니다.

---

## 1. 연구·업계 요약

### 1.1 무엇을 저장할 것인가

- **QA 쌍(FAQ 스타일)**  
  정보를 찾는 질문과 그에 대한 답변이 명확한 1:1 또는 N:N 대화 단위가 핵심 지식 단위입니다.  
  “실제 문제 해결을 위한 정보 요청”에 초점을 두는 것이 좋습니다.
- **실행 가능한 정보**  
  약속(일시·장소), 연락처, 업무 지시, 선호도 등 **재사용 가능한 사실**이 저장 가치가 높습니다.
- **편집·갱신 제안**  
  상담원이 미해결 사례를 어떻게 처리했는지에 대한 요약은 기존 문서 업데이트에 활용할 수 있습니다.

### 1.2 품질 기준 (저장하지 말아야 할 것)

- **PII(개인식별정보)**  
  이름, 전화번호, 주소 등이 포함된 문장은 그대로 저장하지 않고, 익명화·일반화 후에만 저장하는 것이 좋습니다.
- **일시적·상황 종속 대화**  
  “지금 비가 오네요” 등 맥락에만 의미 있는 발화는 지식 베이스에는 적합하지 않습니다.
- **미해결/불명확 답변**  
  “잘 모르겠습니다”, “나중에 연락드리겠습니다”만 있고 실제 정보가 없는 경우는 저장 가치가 낮습니다.
- **환각 위험**  
  LLM이 원문에 없는 질문을 만들어 내는 것을 막기 위해, “원문에 명시된 질문·답변만 추출”하도록 명시하는 것이 좋습니다.

### 1.3 시스템 설계 관점

- FAQ 추출은 **프롬프트만의 문제가 아니라 시스템 설계 문제**입니다.  
  대화 로그 수집 → 클러스터링/누적 → 검증 워크플로(승인/편집/거절)를 함께 고려해야 합니다.
- **누적 기반 아키텍처**: 한 통화 단위가 아니라 여러 통화에서 반복되는 질문·답변을 누적해 품질/노이즈 비율을 개선하는 접근이 권장됩니다.
- **검증 워크플로**: 추출 결과를 단순 UI로 검토(승인/수정/거절)한 뒤 지식 베이스에 반영하면 승인률·정확도가 올라갑니다.

---

## 2. 현재 프롬프트와의 대응

현재 `judge_usefulness` 프롬프트는 대략 다음을 요청합니다.

- 유용한 정보 예시: 약속 일정, 연락처, 업무 지시, 자주 묻는 질문에 대한 답변, 개인 선호도
- 출력: `is_useful`, `confidence`, `reason`, `extracted_info` (text, category, keywords)

이를 위 권장사항에 맞춰 **명시적 기준**으로 보강하는 것이 좋습니다.

---

## 3. 구체적 권장사항 (프롬프트/기준)

### 3.1 유용하다고 판단할 기준 (is_useful = true 권장)

- **실행 가능한 Q&A**  
  고객 질문에 대해 **구체적 사실·절차·답변**이 제시된 경우 (예: 영업시간, 절차, 조건).
- **재사용 가능한 FAQ**  
  다른 통화에서도 그대로 활용할 수 있는 질문·답변 쌍.
- **이슈 해결 내용**  
  문의/불만에 대한 **해결 방법·조치·다음 단계**가 명확히 설명된 경우.
- **약속·일정·연락처**  
  시간, 장소, 담당자, 연락처 등 **구체적 약속·정보**가 포함된 경우 (PII는 저장 시 별도 정책 적용).
- **업무 지시·선호도**  
  “항상 A로 해주세요”, “B는 싫어합니다” 등 **재사용 가능한 지시·선호**가 있는 경우.

### 3.2 유용하지 않다고 판단할 기준 (is_useful = false 권장)

- **PII 노출**  
  개인을 특정할 수 있는 정보만 있고, 일반화·익명화 없이 저장할 경우.
- **인사·맥락만 있는 대화**  
  “네”, “알겠습니다”, “날씨가 좋네요” 등 **지식으로 재사용할 내용이 없는** 경우.
- **미해결/유보**  
  “확인 후 연락드리겠습니다”, “잘 모르겠습니다”만 있고 **실제 정보가 없는** 경우.
- **과도한 주관·감정만**  
  사실·절차 없이 불만·칭찬 등 감정 표현만 있는 경우 (정책에 따라 일부는 요약만 저장할 수 있음).

### 3.3 프롬프트 문구 추가 제안

아래 문장을 `judge_usefulness` 프롬프트의 **판단 기준** 섹션에 추가하는 것을 권장합니다.

```
**유용하다고 판단할 경우:**
- 실행 가능한 질문·답변 (구체적 사실, 절차, 조건이 포함된 경우)
- 다른 통화에서도 재사용 가능한 FAQ 성격의 대화
- 문의/이슈에 대한 해결 방법·다음 단계가 명확한 경우
- 약속·일정·연락처·업무 지시·선호도 등 재사용 가능한 정보 (개인정보는 저장 시 별도 정책 적용)

**유용하지 않다고 판단할 경우:**
- 개인을 특정할 수 있는 정보만 있는 경우 (이름, 전화번호, 주소 등)
- 인사, 맞장구, 날씨 등 지식으로 쓸 내용이 없는 경우
- "확인 후 연락드리겠습니다" 등 미해결·유보만 있는 경우
- 원문에 없는 질문/답변을 만들어 내지 말 것 (원문에 명시된 내용만 추출)
```

### 3.4 출력 형식 (extracted_info) 보강

- **category**  
  예: `약속|정보|지시|선호도|FAQ|이슈해결|기타`  
  “이슈해결”, “FAQ”를 명시하면 나중에 검색·필터링에 유리합니다.
- **PII 플래그**  
  선택적으로 `contains_pii: true/false`를 두어, 저장 파이프라인에서 익명화·검토 대상으로 플래그할 수 있습니다.

---

## 4. 구현 시 참고

- **judgment_max_output_tokens**  
  JSON이 잘리지 않도록 1024 이상 유지(이미 권장됨).  
  위 기준을 넣어도 `reason`을 50자 이내로 유지하면 토큰 사용이 크게 늘지 않습니다.
- **재시도/폴백**  
  JSON 파싱 실패 시 기본값 적용 로직은 이미 구현되어 있으므로, 프롬프트만 위 기준으로 보강하면 됩니다.
- **다음 단계**  
  필요 시 “누적 기반” 추출(여러 통화에서 동일 주제 클러스터링 후 요약)이나, 검토 UI를 통한 승인/편집 워크플로를 별도 설계할 수 있습니다.

---

## 5. 요약

| 항목 | 권장 내용 |
|------|-----------|
| **저장할 것** | 실행 가능한 Q&A, 재사용 FAQ, 이슈 해결 내용, 약속·일정·연락처·지시·선호도 (PII는 정책에 따라) |
| **저장하지 말 것** | PII만 있는 경우, 인사/맥락만 있는 대화, 미해결·유보만, 원문에 없는 환각 |
| **프롬프트** | 위 기준을 판단 규칙으로 명시하고, `reason` 50자 이내·유효 JSON만 출력 유지 |
| **출력** | category에 이슈해결/FAQ 추가, 선택적으로 PII 플래그 |

이 권장사항을 반영하면 “유용성 판단 요청”이 **진짜 저장할 가치가 있는 지식**을 골라 내는 데 더 잘 맞춰질 수 있습니다.

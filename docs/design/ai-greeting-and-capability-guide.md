# AI ì¸ì‚¬ë§ + ì„œë¹„ìŠ¤ ê°€ì´ë“œ ë©˜íŠ¸ ê¸°íšì„œ

> **ì‘ì„±ì¼**: 2026-01-29  
> **ìƒíƒœ**: ê¸°íš ì™„ë£Œ, êµ¬í˜„ ëŒ€ê¸°  
> **ë²”ìœ„**: VectorDB ìŠ¤í‚¤ë§ˆ í™•ì¥ â†’ Backend API â†’ Frontend UI â†’ AI Orchestrator

---

## 1. ê°œìš”

### 1.1 í˜„ì¬ ë¬¸ì œ

| í•­ëª© | í˜„ì¬ ìƒíƒœ | ë¬¸ì œ |
|------|-----------|------|
| AI ì¸ì‚¬ë§ | `organization_info.json`ì˜ ê³ ì • í…œí”Œë¦¿ 4ê°œ ì¤‘ ëœë¤ | `config.yaml`ì˜ `greeting_message` ë¯¸ì‚¬ìš©, ì¼ê´€ì„± ë¶€ì¡± |
| ì„œë¹„ìŠ¤ ê°€ì´ë“œ | ì—†ìŒ | ì‚¬ìš©ìê°€ ë­˜ ìš”ì²­í•  ìˆ˜ ìˆëŠ”ì§€ ëª¨ë¦„ |
| capabilities | `organization_info.json`ì— ë¬¸ìì—´ ë°°ì—´ | VectorDBì™€ ë¶„ë¦¬ë˜ì–´ ìˆì–´ ë™ì  ê´€ë¦¬ ë¶ˆê°€ |
| ì„œë¹„ìŠ¤ë³„ ë™ì‘ êµ¬ë¶„ | ì—†ìŒ | ì •ë³´ ì•ˆë‚´ / API í˜¸ì¶œ / ìƒë‹´ì› ì—°ê²°ì„ êµ¬ë¶„í•˜ì§€ ëª»í•¨ |

### 1.2 ëª©í‘œ

1. **Phase 1 (ê³ ì • ì¸ì‚¬ë§)**: `config.yaml`ì—ì„œ ì½ì€ ì¸ì‚¬ë§ì„ ì¦‰ì‹œ TTS ë°œí™”
2. **Phase 2 (ê°€ì´ë“œ ë©˜íŠ¸)**: VectorDBì—ì„œ í™œì„± ì„œë¹„ìŠ¤ ëª©ë¡ì„ ì¡°íšŒ â†’ LLMì´ ìì—°ì–´ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½ â†’ TTS ë°œí™”
3. **í›„ì† ëŒ€í™”**: ì‚¬ìš©ì ìš”ì²­ ì‹œ `response_type`ì— ë”°ë¼ ì •ë³´ ì•ˆë‚´ / API í˜¸ì¶œ / í˜¸ ì „í™˜ ë“± ë¶„ê¸°

### 1.3 ì—…ê³„ ë²¤ì¹˜ë§ˆí¬

| ì‹œìŠ¤í…œ | ì¸ì‚¬ë§ | ê°€ì´ë“œ |
|--------|--------|--------|
| Ada.cx Voice | ê³ ì • Greeting Builder + "AIì„ì„ ë°í˜" | open-ended ì§ˆë¬¸ ìœ ë„ |
| Google Business Messages | ê³ ì • Welcome + Conversation Starters (ë²„íŠ¼ 3~5ê°œ) | ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ ì¹´ë“œ |
| Dialogflow CX | ê³ ì • Welcome Intent | Routeë³„ capabilities |
| VoiceBooker (Multi-stage) | Stage 1: ê³ ì • Welcome | Stage 2: ë™ì  task-specific |
| AURA (2025 ë…¼ë¬¸) | â€” | function-callingìœ¼ë¡œ calendar, email, search ë“± tool í˜¸ì¶œ |

**ê³µí†µ íŒ¨í„´**: 2-Phase Greeting (ê³ ì • ì¸ì‚¬ â†’ ë™ì  ê°€ì´ë“œ)

---

## 2. 2-Phase Greeting ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: ê³ ì • ì¸ì‚¬ë§ (config.yaml)                  â”‚
â”‚                                                       â”‚
â”‚  "ì•ˆë…•í•˜ì„¸ìš”, â—‹â—‹â—‹ì˜ AI ë¹„ì„œì…ë‹ˆë‹¤."                   â”‚
â”‚                                                       â”‚
â”‚  â€¢ ì¦‰ì‹œ TTS ë°œí™” (ì§€ì—° 0ì´ˆ)                           â”‚
â”‚  â€¢ config.yaml â†’ greeting_message ê°’ ì‚¬ìš©             â”‚
â”‚  â€¢ Barge-in ë¹„í™œì„±í™”                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼  (Phase 1 ë°œí™” ì¤‘ Phase 2 ë³‘ë ¬ ìƒì„±)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: ê°€ì´ë“œ ë©˜íŠ¸ (VectorDB â†’ LLM ìš”ì•½)          â”‚
â”‚                                                       â”‚
â”‚  "ì €ëŠ” ì˜¤ì‹œëŠ”ê¸¸ ì•ˆë‚´, ì£¼ì°¨ ì•ˆë‚´, ì˜ì—…ì‹œê°„ ì•ˆë‚´,        â”‚
â”‚   ë©”ë‰´ ì•ˆë‚´, ìƒë‹´ì› ì—°ê²°ì„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”.        â”‚
â”‚   ì–´ë–¤ ê²ƒì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?"                             â”‚
â”‚                                                       â”‚
â”‚  â€¢ VectorDBì—ì„œ doc_type=capability ì¡°íšŒ              â”‚
â”‚  â€¢ LLMì´ display_name ëª©ë¡ â†’ ìì—°ì–´ í•œ ë¬¸ì¥           â”‚
â”‚  â€¢ ê²°ê³¼ ìºì‹± (ownerë³„, TTL ê¸°ë°˜)                      â”‚
â”‚  â€¢ Barge-in í™œì„±í™” (ì¤‘ê°„ì— ëŠê³  ë§í•  ìˆ˜ ìˆìŒ)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
          [LISTENING ìƒíƒœ ì§„ì…]
```

### íƒ€ì´ë° ì˜ˆì‚°

| ë‹¨ê³„ | ì†Œìš” ì‹œê°„ | ë¹„ê³  |
|------|-----------|------|
| Phase 1 TTS í•©ì„± | ~0.5ì´ˆ | ì§§ì€ ë¬¸ì¥, Google Neural TTS |
| Phase 1 ë°œí™” | ~2ì´ˆ | "ì•ˆë…•í•˜ì„¸ìš”. ê¸°ìƒì²­ AI ë¹„ì„œì…ë‹ˆë‹¤." |
| Phase 2 ìƒì„± (ìºì‹œ íˆíŠ¸) | 0ms | ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ |
| Phase 2 ìƒì„± (ìºì‹œ ë¯¸ìŠ¤) | ~1.5ì´ˆ | LLM í˜¸ì¶œ, Phase 1 ë°œí™” ì¤‘ ë³‘ë ¬ |
| Phase 2 ë°œí™” | ~4ì´ˆ | ê°€ì´ë“œ ë©˜íŠ¸ ì „ì²´ |
| **ì´ ì²´ê°** | **~6ì´ˆ** | ì‚¬ìš©ìëŠ” 0.5ì´ˆ í›„ë¶€í„° AI ëª©ì†Œë¦¬ë¥¼ ë“¤ìŒ |

---

## 3. VectorDB ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### 3.1 í˜„ì¬ ìŠ¤í‚¤ë§ˆ

```
Collection: "knowledge_base"
Document metadata:
  - category    : str   ("faq", "policy", "support", "product", "manual")
  - keywords    : str   (ì‰¼í‘œ êµ¬ë¶„)
  - created_at  : str
  - source      : str   ("manual", "hitl", "extracted")
  - usageCount  : str
  - addedBy     : str
```

### 3.2 í™•ì¥ ìŠ¤í‚¤ë§ˆ

ê¸°ì¡´ í•„ë“œë¥¼ ìœ ì§€í•˜ë©´ì„œ `doc_type` + `response_type` ë“±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
ê¸°ì¡´ ë¬¸ì„œëŠ” `doc_type=knowledge`ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤ (í•˜ìœ„ í˜¸í™˜).

```
Collection: "knowledge_base" (ë‹¨ì¼ ì»¬ë ‰ì…˜ ìœ ì§€)

â•â•â• ê³µí†µ ë©”íƒ€ë°ì´í„° (ëª¨ë“  doc_type) â•â•â•
  doc_type      : str    "capability" | "faq" | "knowledge"
                         (ê¸°ì¡´ ë¬¸ì„œëŠ” ë¯¸ì„¤ì • â†’ "knowledge"ë¡œ ì·¨ê¸‰)
  category      : str    ì¹´í…Œê³ ë¦¬ slug
  keywords      : str    ì‰¼í‘œ êµ¬ë¶„ í‚¤ì›Œë“œ
  created_at    : str    ISO 8601
  updated_at    : str    ISO 8601
  source        : str    "manual" | "hitl" | "extracted" | "seed"
  owner         : str    ì†Œìœ ì ID (ë©€í‹°í…Œë„ŒíŠ¸)
  is_active     : bool   í™œì„±í™” ì—¬ë¶€ (ê¸°ë³¸ true)

â•â•â• capability ì „ìš© ë©”íƒ€ë°ì´í„° â•â•â•
  display_name  : str    ê°€ì´ë“œ ë©˜íŠ¸ í‘œì‹œëª… ("ë§¤ì¥ ì£¼ì°¨ ì•ˆë‚´")
  response_type : str    "info" | "api_call" | "transfer" | "collect"
  priority      : int    ê°€ì´ë“œ ë©˜íŠ¸ ë…¸ì¶œ ìˆœì„œ (ë‚®ì„ìˆ˜ë¡ ìš°ì„ )
  api_endpoint  : str    response_type=api_call ì‹œ í˜¸ì¶œ URL
  api_method    : str    "GET" | "POST"
  api_params    : str    JSON string, API íŒŒë¼ë¯¸í„° ì •ì˜
  transfer_to   : str    response_type=transfer ì‹œ ì—°ê²° ëŒ€ìƒ (SIP URI/ë²ˆí˜¸)
  collect_fields: str    response_type=collect ì‹œ ìˆ˜ì§‘ í•­ëª© JSON
```

### 3.3 response_type ë¶„ë¥˜

| response_type | ì„¤ëª… | AI ë™ì‘ | ì˜ˆì‹œ |
|---------------|------|---------|------|
| `info` | ì •ë³´ ì•ˆë‚´ | VectorDB ë¬¸ì„œ ë‚´ìš©ìœ¼ë¡œ TTS ì‘ë‹µ | ì˜ì—…ì‹œê°„, ì£¼ì†Œ, ë©”ë‰´ |
| `api_call` | ì™¸ë¶€ API í˜¸ì¶œ | API í˜¸ì¶œ â†’ ê²°ê³¼ ê°€ê³µ â†’ TTS | ì‹¤ì‹œê°„ ë‚ ì”¨, ì˜ˆì•½ í™•ì¸ |
| `transfer` | ìƒë‹´ì›/ë¶€ì„œ ì—°ê²° | SIP í˜¸ ì „í™˜ ì‹¤í–‰ | "ë‹´ë‹¹ì ì—°ê²°" |
| `collect` | ì •ë³´ ìˆ˜ì§‘ í•„ìš” | ë©€í‹°í„´ ì§ˆë¬¸ â†’ ìˆ˜ì§‘ â†’ ì²˜ë¦¬ | ì˜ˆì•½ ì ‘ìˆ˜ (ì´ë¦„/ë‚ ì§œ/ì¸ì›) |

### 3.4 ë°ì´í„° ì˜ˆì‹œ

```json
[
  {
    "id": "cap_directions",
    "document": "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123. ì§€í•˜ì²  2í˜¸ì„  ê°•ë‚¨ì—­ 3ë²ˆ ì¶œêµ¬ì—ì„œ ë„ë³´ 5ë¶„.",
    "metadata": {
      "doc_type": "capability",
      "category": "location",
      "display_name": "ì˜¤ì‹œëŠ”ê¸¸ ì•ˆë‚´",
      "response_type": "info",
      "priority": 1,
      "is_active": true,
      "owner": "store_gangnam",
      "keywords": "ì˜¤ì‹œëŠ”ê¸¸,ìœ„ì¹˜,ì£¼ì†Œ,ì°¾ì•„ì˜¤ëŠ”ë°©ë²•",
      "source": "seed",
      "created_at": "2026-01-29T00:00:00"
    }
  },
  {
    "id": "cap_transfer",
    "document": "ë‹´ë‹¹ ìƒë‹´ì›ì—ê²Œ ì „í™”ë¥¼ ì—°ê²°í•´ ë“œë¦½ë‹ˆë‹¤.",
    "metadata": {
      "doc_type": "capability",
      "category": "transfer",
      "display_name": "ìƒë‹´ì› ì—°ê²°",
      "response_type": "transfer",
      "transfer_to": "sip:operator@pbx.local",
      "priority": 99,
      "is_active": true,
      "owner": "store_gangnam",
      "keywords": "ìƒë‹´ì›,ë‹´ë‹¹ì,ì‚¬ëŒ,ì—°ê²°",
      "source": "seed",
      "created_at": "2026-01-29T00:00:00"
    }
  },
  {
    "id": "cap_weather",
    "document": "ê¸°ìƒì²­ APIë¥¼ í†µí•´ ì‹¤ì‹œê°„ ë‚ ì”¨ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.",
    "metadata": {
      "doc_type": "capability",
      "category": "weather",
      "display_name": "ì‹¤ì‹œê°„ ë‚ ì”¨ ì¡°íšŒ",
      "response_type": "api_call",
      "api_endpoint": "https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtNcst",
      "api_method": "GET",
      "api_params": "{\"serviceKey\": \"...\", \"numOfRows\": 10}",
      "priority": 5,
      "is_active": true,
      "owner": "store_gangnam",
      "keywords": "ë‚ ì”¨,ê¸°ì˜¨,ë¹„,ëˆˆ",
      "source": "seed",
      "created_at": "2026-01-29T00:00:00"
    }
  }
]
```

### 3.5 ì´ˆê¸° ì‹œë”© ì •ì±…

| ì‹œì  | ë™ì‘ |
|------|------|
| ìµœì´ˆ ì„œë²„ ì‹œì‘ | `doc_type=capability` ë¬¸ì„œ ìˆ˜ í™•ì¸ â†’ 0ê°œë©´ ì‹œë“œ ë°ì´í„° íˆ¬ì… |
| ì´í›„ ì„œë²„ ì¬ì‹œì‘ | VectorDBëŠ” PersistentClient â†’ ìŠ¤í‚µ |
| ìš´ì˜ ì¤‘ | Frontend UI ë˜ëŠ” APIë¡œ CRUD â†’ VectorDBê°€ ì •ë³¸(source of truth) |

---

## 4. Backend API ë³€ê²½

### 4.1 í˜„ì¬ API êµ¬ì¡°

```
GET    /api/knowledge/          â†’ ì „ì²´ ì¡°íšŒ (category í•„í„°)
POST   /api/knowledge/          â†’ ì¶”ê°€
PUT    /api/knowledge/{id}      â†’ ìˆ˜ì •
DELETE /api/knowledge/{id}      â†’ ì‚­ì œ
```

í˜„ì¬ Pydantic ëª¨ë¸:
```python
class KnowledgeEntryCreate(BaseModel):
    text: str
    category: str
    keywords: List[str]
    metadata: Optional[Dict[str, Any]] = {}
```

### 4.2 í™•ì¥: Capability ì „ìš© API

ê¸°ì¡´ knowledge APIì— `doc_type` í•„í„°ë¥¼ ì¶”ê°€í•˜ê³ , capability ì „ìš© í¸ì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‹ ì„¤í•©ë‹ˆë‹¤.

```
# â•â•â• ê¸°ì¡´ knowledge API (doc_type í•„í„° ì¶”ê°€) â•â•â•
GET    /api/knowledge/?doc_type=capability    â†’ capabilityë§Œ ì¡°íšŒ
GET    /api/knowledge/?doc_type=faq           â†’ FAQë§Œ ì¡°íšŒ
GET    /api/knowledge/?doc_type=knowledge     â†’ ì¼ë°˜ ì§€ì‹ë§Œ ì¡°íšŒ

# â•â•â• ì‹ ê·œ: Capability ì „ìš© í¸ì˜ API â•â•â•
GET    /api/capabilities/                     â†’ í™œì„± capability ëª©ë¡ (is_active=true, priority ì •ë ¬)
POST   /api/capabilities/                     â†’ capability ì¶”ê°€ (doc_type ìë™ ì„¤ì •)
PUT    /api/capabilities/{id}                 â†’ capability ìˆ˜ì •
DELETE /api/capabilities/{id}                 â†’ capability ì‚­ì œ
PATCH  /api/capabilities/{id}/toggle          â†’ í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€
PUT    /api/capabilities/reorder              â†’ ìš°ì„ ìˆœìœ„ ì¼ê´„ ë³€ê²½

# â•â•â• ì‹ ê·œ: ê°€ì´ë“œ ë©˜íŠ¸ API (AI Orchestratorê°€ í˜¸ì¶œ) â•â•â•
GET    /api/capabilities/guide-text?owner={owner_id}
                                              â†’ ìºì‹±ëœ ê°€ì´ë“œ ë©˜íŠ¸ í…ìŠ¤íŠ¸ ë°˜í™˜
POST   /api/capabilities/guide-text/refresh   â†’ ìºì‹œ ë¬´íš¨í™” + ì¬ìƒì„±
```

### 4.3 Pydantic ëª¨ë¸ í™•ì¥

```python
# â•â•â• ì‹ ê·œ ëª¨ë¸ â•â•â•

class CapabilityCreate(BaseModel):
    """ì„œë¹„ìŠ¤(Capability) ìƒì„±"""
    display_name: str                                    # "ë§¤ì¥ ì£¼ì°¨ ì•ˆë‚´"
    text: str                                            # ìƒì„¸ ì•ˆë‚´ ë‚´ìš©
    category: str                                        # "parking"
    response_type: Literal["info", "api_call", "transfer", "collect"] = "info"
    keywords: List[str] = []
    priority: int = 50                                   # 1~99
    is_active: bool = True
    owner: Optional[str] = None

    # response_typeë³„ ì„ íƒ í•„ë“œ
    api_endpoint: Optional[str] = None                   # api_callìš©
    api_method: Optional[Literal["GET", "POST"]] = None
    api_params: Optional[Dict[str, Any]] = None
    transfer_to: Optional[str] = None                    # transferìš©
    collect_fields: Optional[List[Dict]] = None          # collectìš©


class CapabilityEntry(BaseModel):
    """ì„œë¹„ìŠ¤(Capability) ì‘ë‹µ"""
    id: str
    display_name: str
    text: str
    category: str
    response_type: str
    keywords: List[str]
    priority: int
    is_active: bool
    owner: Optional[str] = None
    api_endpoint: Optional[str] = None
    api_method: Optional[str] = None
    api_params: Optional[Dict[str, Any]] = None
    transfer_to: Optional[str] = None
    collect_fields: Optional[List[Dict]] = None
    created_at: str
    updated_at: Optional[str] = None


class CapabilityListResponse(BaseModel):
    """ì„œë¹„ìŠ¤ ëª©ë¡ ì‘ë‹µ"""
    items: List[CapabilityEntry]
    total: int


class GuideTextResponse(BaseModel):
    """ê°€ì´ë“œ ë©˜íŠ¸ ì‘ë‹µ"""
    text: str
    capability_count: int
    cached: bool
    generated_at: str
```

---

## 5. Frontend UI ë³€ê²½

### 5.1 í˜„ì¬ Frontend êµ¬ì¡°

```
/knowledge          â†’ ì§€ì‹ ê´€ë¦¬ (list, íƒ­: faq/support/product/policy/hitl)
/knowledge/add      â†’ ì§€ì‹ ì¶”ê°€ (text, category, keywords)
/knowledge/[id]/editâ†’ ì§€ì‹ ìˆ˜ì •
/dashboard          â†’ ìš´ì˜ ëŒ€ì‹œë³´ë“œ
```

### 5.2 ì‹ ê·œ í˜ì´ì§€: `/capabilities` (ì„œë¹„ìŠ¤ ê´€ë¦¬)

Knowledge í˜ì´ì§€ì™€ ë³„ë„ë¡œ **ì„œë¹„ìŠ¤(Capability) ì „ìš© ê´€ë¦¬ í˜ì´ì§€**ë¥¼ ì‹ ì„¤í•©ë‹ˆë‹¤.

```
/capabilities               â†’ ì„œë¹„ìŠ¤ ê´€ë¦¬ ë©”ì¸
/capabilities/add           â†’ ì„œë¹„ìŠ¤ ì¶”ê°€
/capabilities/[id]/edit     â†’ ì„œë¹„ìŠ¤ ìˆ˜ì •
```

### 5.3 ì„œë¹„ìŠ¤ ê´€ë¦¬ ë©”ì¸ (`/capabilities`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– AI ì„œë¹„ìŠ¤ ê´€ë¦¬                              [+ ì„œë¹„ìŠ¤ ì¶”ê°€] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ğŸ“‹ ê°€ì´ë“œ ë©˜íŠ¸ ë¯¸ë¦¬ë³´ê¸°                          [ğŸ”„ ìƒˆë¡œê³ ì¹¨]  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ "ì €ëŠ” ì˜¤ì‹œëŠ”ê¸¸ ì•ˆë‚´, ì£¼ì°¨ ì•ˆë‚´, ì˜ì—…ì‹œê°„ ì•ˆë‚´,          â”‚ â”‚
â”‚  â”‚  ë©”ë‰´ ì•ˆë‚´, ìƒë‹´ì› ì—°ê²°ì„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”.           â”‚ â”‚
â”‚  â”‚  ì–´ë–¤ ê²ƒì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?"                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                               â”‚
â”‚  [ì „ì²´] [ì •ë³´ì•ˆë‚´] [APIì—°ë™] [ìƒë‹´ì›ì—°ê²°] [ì •ë³´ìˆ˜ì§‘]           â”‚
â”‚                                                               â”‚
â”‚  ìˆœì„œ  í™œì„±  ì„œë¹„ìŠ¤ëª…         ìœ í˜•        ì¹´í…Œê³ ë¦¬    ë™ì‘      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â ¿ 1  ğŸŸ¢  ì˜¤ì‹œëŠ”ê¸¸ ì•ˆë‚´     ğŸ“„ ì •ë³´ì•ˆë‚´  location   [í¸ì§‘][ì‚­ì œ]â”‚
â”‚  â ¿ 2  ğŸŸ¢  ë§¤ì¥ ì£¼ì°¨ ì•ˆë‚´    ğŸ“„ ì •ë³´ì•ˆë‚´  parking    [í¸ì§‘][ì‚­ì œ]â”‚
â”‚  â ¿ 3  ğŸŸ¢  ì˜ì—…ì‹œê°„ ì•ˆë‚´     ğŸ“„ ì •ë³´ì•ˆë‚´  hours      [í¸ì§‘][ì‚­ì œ]â”‚
â”‚  â ¿ 4  ğŸŸ¢  íŒë§¤ ë©”ë‰´ ì•ˆë‚´    ğŸ“„ ì •ë³´ì•ˆë‚´  menu       [í¸ì§‘][ì‚­ì œ]â”‚
â”‚  â ¿ 5  ğŸŸ¢  ì‹¤ì‹œê°„ ë‚ ì”¨ ì¡°íšŒ  ğŸ”— APIì—°ë™   weather    [í¸ì§‘][ì‚­ì œ]â”‚
â”‚  â ¿ 99 ğŸŸ¢  ìƒë‹´ì› ì—°ê²°       ğŸ“ ìƒë‹´ì›    transfer   [í¸ì§‘][ì‚­ì œ]â”‚
â”‚  â”€â”€ â”€  ğŸ”´  ì´ë²¤íŠ¸ ì•ˆë‚´       ğŸ“„ ì •ë³´ì•ˆë‚´  event      [í¸ì§‘][ì‚­ì œ]â”‚
â”‚                                                               â”‚
â”‚  â ¿ = ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½, ğŸŸ¢/ğŸ”´ = í™œì„±/ë¹„í™œì„± í† ê¸€             â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ ê¸°ëŠ¥:**

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ê°€ì´ë“œ ë©˜íŠ¸ ë¯¸ë¦¬ë³´ê¸° | VectorDBì˜ í™œì„± capability â†’ LLM ìš”ì•½ ê²°ê³¼ë¥¼ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° |
| ë“œë˜ê·¸ ì •ë ¬ | priority ê°’ì„ ë“œë˜ê·¸&ë“œë¡­ìœ¼ë¡œ ë³€ê²½ â†’ `PUT /api/capabilities/reorder` |
| í™œì„±/ë¹„í™œì„± í† ê¸€ | ìŠ¤ìœ„ì¹˜ í´ë¦­ â†’ `PATCH /api/capabilities/{id}/toggle` |
| íƒ­ í•„í„° | response_typeë³„ í•„í„° (ì „ì²´, ì •ë³´ì•ˆë‚´, APIì—°ë™, ìƒë‹´ì›ì—°ê²°, ì •ë³´ìˆ˜ì§‘) |
| ì¶”ê°€/í¸ì§‘/ì‚­ì œ | í‘œì¤€ CRUD |

### 5.4 ì„œë¹„ìŠ¤ ì¶”ê°€/í¸ì§‘ í¼ (`/capabilities/add`, `/capabilities/[id]/edit`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â• ìƒˆ ì„œë¹„ìŠ¤ ì¶”ê°€                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ì„œë¹„ìŠ¤ëª… *                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ë§¤ì¥ ì£¼ì°¨ ì•ˆë‚´                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  ì¹´í…Œê³ ë¦¬ *           ì‘ë‹µ ìœ í˜• *                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ parking    â–¼ â”‚    â”‚ ğŸ“„ ì •ë³´ ì•ˆë‚´       â–¼ â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                               â”‚
â”‚  ì•ˆë‚´ ë‚´ìš© *                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ì§€í•˜ 1~3ì¸µì— ê³ ê° ì „ìš© ì£¼ì°¨ì¥ì´ ìˆìœ¼ë©°, 2ì‹œê°„ ë¬´ë£Œ      â”‚ â”‚
â”‚  â”‚ ì£¼ì°¨ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´í›„ 30ë¶„ë‹¹ 1,000ì›ì´ ë¶€ê³¼ë©ë‹ˆë‹¤.    â”‚ â”‚
â”‚  â”‚ 5ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ì¶”ê°€ 1ì‹œê°„ ë¬´ë£Œì…ë‹ˆë‹¤.               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  í‚¤ì›Œë“œ (ì‰¼í‘œ êµ¬ë¶„)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ì£¼ì°¨, ì£¼ì°¨ì¥, ì£¼ì°¨ë¹„, ë¬´ë£Œì£¼ì°¨, ë°œë ›                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€ ì‘ë‹µ ìœ í˜•ë³„ ì¶”ê°€ ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  (response_type = "info" ì¼ ë•Œ)                         â”‚  â”‚
â”‚  â”‚  â†’ ì¶”ê°€ ì„¤ì • ì—†ìŒ                                       â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  (response_type = "api_call" ì¼ ë•Œ)                     â”‚  â”‚
â”‚  â”‚  API URL *      [https://api.example.com/weather     ]  â”‚  â”‚
â”‚  â”‚  HTTP ë©”ì„œë“œ    [GET â–¼]                                 â”‚  â”‚
â”‚  â”‚  íŒŒë¼ë¯¸í„° (JSON) [{...}                              ]  â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  (response_type = "transfer" ì¼ ë•Œ)                     â”‚  â”‚
â”‚  â”‚  ì—°ê²° ëŒ€ìƒ *    [sip:operator@pbx.local              ]  â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  (response_type = "collect" ì¼ ë•Œ)                      â”‚  â”‚
â”‚  â”‚  ìˆ˜ì§‘ í•­ëª©:                                              â”‚  â”‚
â”‚  â”‚    [+ í•­ëª© ì¶”ê°€]                                        â”‚  â”‚
â”‚  â”‚    1. ì´ë¦„  (í•„ìˆ˜) [í…ìŠ¤íŠ¸]                              â”‚  â”‚
â”‚  â”‚    2. ë‚ ì§œ  (í•„ìˆ˜) [ë‚ ì§œ]                                â”‚  â”‚
â”‚  â”‚    3. ì¸ì›  (í•„ìˆ˜) [ìˆ«ì]                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  ìš°ì„ ìˆœìœ„        í™œì„±í™”                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ 2      â”‚    â”‚ ğŸŸ¢ ON      â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                               â”‚
â”‚              [ì·¨ì†Œ]  [ì €ì¥]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 ê¸°ì¡´ Knowledge í˜ì´ì§€ ë³€ê²½

ê¸°ì¡´ `/knowledge` í˜ì´ì§€ëŠ” **ì¼ë°˜ ì§€ì‹/FAQ ê´€ë¦¬** ìš©ë„ë¡œ ìœ ì§€í•˜ë˜, íƒ­ êµ¬ì„±ì„ ì¡°ì •í•©ë‹ˆë‹¤.

```
ë³€ê²½ ì „ íƒ­: [FAQ] [ê³ ê°ì§€ì›] [ì œí’ˆì •ë³´] [ì •ì±…] [HITLì €ì¥]
ë³€ê²½ í›„ íƒ­: [FAQ] [ê³ ê°ì§€ì›] [ì œí’ˆì •ë³´] [ì •ì±…] [HITLì €ì¥] [í†µí™”ì¶”ì¶œ]

* "ì„œë¹„ìŠ¤(Capability)" í•­ëª©ì€ /capabilities í˜ì´ì§€ë¡œ ë¶„ë¦¬
* knowledge í˜ì´ì§€ì—ì„œëŠ” doc_type=knowledge, faqë§Œ í‘œì‹œ
```

### 5.6 ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ì¶”ê°€

```
í˜„ì¬:                          ë³€ê²½ í›„:
â”œâ”€â”€ ğŸ  ëŒ€ì‹œë³´ë“œ                â”œâ”€â”€ ğŸ  ëŒ€ì‹œë³´ë“œ
â”œâ”€â”€ ğŸ“ í†µí™” ì´ë ¥               â”œâ”€â”€ ğŸ“ í†µí™” ì´ë ¥
â”œâ”€â”€ ğŸ“š ì§€ì‹ ê´€ë¦¬               â”œâ”€â”€ ğŸ“š ì§€ì‹ ê´€ë¦¬
â””â”€â”€ ...                        â”œâ”€â”€ ğŸ¤– ì„œë¹„ìŠ¤ ê´€ë¦¬  â† ì‹ ê·œ
                               â””â”€â”€ ...
```

### 5.7 ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ ì¶”ê°€

ëŒ€ì‹œë³´ë“œì— ì„œë¹„ìŠ¤ ìƒíƒœ ìš”ì•½ ì¹´ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– AI ì„œë¹„ìŠ¤ í˜„í™©    â”‚
â”‚                       â”‚
â”‚  í™œì„± ì„œë¹„ìŠ¤: 6ê°œ      â”‚
â”‚  ë¹„í™œì„±: 1ê°œ           â”‚
â”‚                       â”‚
â”‚  ìœ í˜•ë³„:               â”‚
â”‚  ğŸ“„ ì •ë³´ì•ˆë‚´: 4        â”‚
â”‚  ğŸ”— APIì—°ë™: 1         â”‚
â”‚  ğŸ“ ìƒë‹´ì›ì—°ê²°: 1      â”‚
â”‚                       â”‚
â”‚  [ì„œë¹„ìŠ¤ ê´€ë¦¬ â†’]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. AI Orchestrator ë³€ê²½

### 6.1 play_greeting() ê°œí¸

```python
async def play_greeting(self):
    """2-Phase Greeting"""

    # â•â•â• Phase 1: ê³ ì • ì¸ì‚¬ë§ (config.yaml) â•â•â•
    fixed_greeting = self.config.get('greeting_message',
                                      'ì•ˆë…•í•˜ì„¸ìš”. AI ë¹„ì„œì…ë‹ˆë‹¤.')
    await self.barge_in_controller.on_tts_start()

    # Phase 2ë¥¼ Phase 1 ë°œí™” ì¤‘ ë³‘ë ¬ ìƒì„±
    guide_task = asyncio.create_task(self._generate_capability_guide())

    await self.speak(fixed_greeting)

    # â•â•â• Phase 2: ê°€ì´ë“œ ë©˜íŠ¸ (VectorDB ê¸°ë°˜) â•â•â•
    guide_text = await guide_task  # ì´ë¯¸ ì™„ë£Œë˜ì—ˆì„ ê°€ëŠ¥ì„± ë†’ìŒ
    if guide_text:
        await self.barge_in_controller.on_tts_end()
        await self.speak(guide_text)
    else:
        await self.barge_in_controller.on_tts_end()
```

### 6.2 _generate_capability_guide()

```python
async def _generate_capability_guide(self) -> Optional[str]:
    """VectorDBì—ì„œ í™œì„± ì„œë¹„ìŠ¤ ëª©ë¡ â†’ LLM ìì—°ì–´ ìš”ì•½"""

    # 1. ìºì‹œ í™•ì¸ (ownerë³„, TTL ê¸°ë°˜)
    cached = self._capability_guide_cache.get(self.callee)
    if cached and not cached.is_expired():
        return cached.text

    # 2. VectorDBì—ì„œ capability ëª©ë¡ ì¡°íšŒ
    capabilities = await self.rag.vector_db.search_by_metadata(
        where={
            "doc_type": "capability",
            "is_active": True,
            "owner": self.callee
        },
        sort_by="priority"
    )

    if not capabilities:
        return None

    # 3. display_name ì¶”ì¶œ (priority ìˆœ)
    display_names = [cap.metadata["display_name"] for cap in capabilities]
    max_items = self.config.get('capability_guide', {}).get('max_items', 5)
    display_names = display_names[:max_items]

    # 4. LLMìœ¼ë¡œ ìì—°ì–´ ìš”ì•½
    items_text = ", ".join(display_names)
    prompt = f"ë‹¤ìŒ í•­ëª©ì„ ìì—°ì–´ í•œ ë¬¸ì¥ìœ¼ë¡œ ì•ˆë‚´í•˜ì„¸ìš”: {items_text}"
    guide_text = await self.llm.generate_response(
        user_text=prompt,
        context_docs=[],
        call_id=self.call_id,
        system_prompt="ì „í™” ìƒë‹´ ì•ˆë‚´ ë©˜íŠ¸ë¥¼ ê°„ê²°í•˜ê²Œ ìƒì„±í•˜ì„¸ìš”. "
                      "í˜•ì‹: 'ì €ëŠ” A, B, Cë¥¼ ì•ˆë‚´í•´ ë“œë¦´ ìˆ˜ ìˆì–´ìš”. "
                      "ì–´ë–¤ ê²ƒì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?'"
    )

    # 5. ìºì‹œ ì €ì¥
    self._capability_guide_cache.set(self.callee, guide_text, ttl=3600)

    return guide_text
```

### 6.3 í›„ì† ëŒ€í™”ì—ì„œ response_type ë¶„ê¸°

```python
async def generate_and_speak_response(self, user_text: str):
    """RAG ê²€ìƒ‰ â†’ response_typeë³„ ë¶„ê¸°"""

    # 1. RAG ê²€ìƒ‰
    documents = await self.rag.search(query=user_text, owner_filter=self.callee)

    if not documents:
        await self.speak("ì£„ì†¡í•©ë‹ˆë‹¤. ê´€ë ¨ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
        return

    top_doc = documents[0]
    response_type = top_doc.metadata.get("response_type", "info")

    # 2. response_typeë³„ ë¶„ê¸°
    if response_type == "info":
        # ì •ë³´ ì•ˆë‚´: LLMì´ ë¬¸ì„œ ë‚´ìš© ê¸°ë°˜ ë‹µë³€ ìƒì„±
        response = await self.llm.generate_response(
            user_text=user_text,
            context_docs=[doc.text for doc in documents],
            call_id=self.call_id
        )
        await self.speak(response)

    elif response_type == "transfer":
        # ìƒë‹´ì› ì—°ê²°
        transfer_to = top_doc.metadata.get("transfer_to")
        await self.speak("ë„¤, ë‹´ë‹¹ìì—ê²Œ ì—°ê²°í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.")
        # SIP PBX í˜¸ ì „í™˜ íŠ¸ë¦¬ê±°
        await self._trigger_call_transfer(transfer_to)

    elif response_type == "api_call":
        # ì™¸ë¶€ API í˜¸ì¶œ
        api_result = await self._call_external_api(top_doc.metadata)
        response = await self.llm.generate_response(
            user_text=user_text,
            context_docs=[api_result],
            call_id=self.call_id
        )
        await self.speak(response)

    elif response_type == "collect":
        # ì •ë³´ ìˆ˜ì§‘ (ë©€í‹°í„´)
        collect_fields = json.loads(top_doc.metadata.get("collect_fields", "[]"))
        await self._start_collection_flow(collect_fields)
```

---

## 7. ì „ì²´ ì‹œìŠ¤í…œ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (Next.js)                                               â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ /dashboard â”‚  â”‚ /knowledge     â”‚  â”‚ /capabilities        â”‚    â”‚
â”‚  â”‚ (ëŒ€ì‹œë³´ë“œ)  â”‚  â”‚ (ì§€ì‹ ê´€ë¦¬)     â”‚  â”‚ (ì„œë¹„ìŠ¤ ê´€ë¦¬) â† ì‹ ê·œ  â”‚    â”‚
â”‚  â”‚            â”‚  â”‚ doc_type:      â”‚  â”‚ doc_type:            â”‚    â”‚
â”‚  â”‚ ì„œë¹„ìŠ¤í˜„í™©  â”‚  â”‚ knowledge,faq  â”‚  â”‚ capability           â”‚    â”‚
â”‚  â”‚ ìœ„ì ¯      â”‚  â”‚               â”‚  â”‚                      â”‚    â”‚
â”‚  â”‚            â”‚  â”‚ CRUD          â”‚  â”‚ CRUD + ìˆœì„œë³€ê²½       â”‚    â”‚
â”‚  â”‚            â”‚  â”‚               â”‚  â”‚ + í™œì„±í† ê¸€           â”‚    â”‚
â”‚  â”‚            â”‚  â”‚               â”‚  â”‚ + ê°€ì´ë“œë©˜íŠ¸ ë¯¸ë¦¬ë³´ê¸° â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚        â”‚                 â”‚                      â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                      â”‚
         â–¼                 â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend (FastAPI)                                                â”‚
â”‚                                                                    â”‚
â”‚  GET /api/knowledge/          â† doc_type í•„í„° ì¶”ê°€                â”‚
â”‚  POST/PUT/DELETE /api/knowledge/*                                 â”‚
â”‚                                                                    â”‚
â”‚  GET /api/capabilities/       â† ì‹ ê·œ (í™œì„± ëª©ë¡, priority ì •ë ¬)   â”‚
â”‚  POST/PUT/DELETE /api/capabilities/*                              â”‚
â”‚  PATCH /api/capabilities/{id}/toggle                              â”‚
â”‚  PUT /api/capabilities/reorder                                    â”‚
â”‚  GET /api/capabilities/guide-text                                 â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ KnowledgeService    â”‚                                         â”‚
â”‚  â”‚ (í™•ì¥: doc_type ì§€ì›)â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChromaDB (knowledge_base collection)                             â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ doc_type=    â”‚  â”‚ doc_type=    â”‚  â”‚ doc_type=             â”‚   â”‚
â”‚  â”‚ capability   â”‚  â”‚ faq          â”‚  â”‚ knowledge             â”‚   â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                       â”‚   â”‚
â”‚  â”‚ response_typeâ”‚  â”‚ category     â”‚  â”‚ (í†µí™” ì¶”ì¶œ ì§€ì‹)       â”‚   â”‚
â”‚  â”‚ display_name â”‚  â”‚ question     â”‚  â”‚                       â”‚   â”‚
â”‚  â”‚ priority     â”‚  â”‚ answer       â”‚  â”‚                       â”‚   â”‚
â”‚  â”‚ is_active    â”‚  â”‚              â”‚  â”‚                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Orchestrator (SIP PBX í”„ë¡œì„¸ìŠ¤)                               â”‚
â”‚                                                                    â”‚
â”‚  play_greeting()                                                  â”‚
â”‚   â”œâ”€ Phase 1: config.yaml â†’ greeting_message â†’ TTS               â”‚
â”‚   â””â”€ Phase 2: VectorDB(capability) â†’ LLM ìš”ì•½ â†’ TTS              â”‚
â”‚                                                                    â”‚
â”‚  generate_and_speak_response()                                    â”‚
â”‚   â”œâ”€ RAG ê²€ìƒ‰ â†’ response_type í™•ì¸                                â”‚
â”‚   â”œâ”€ info      â†’ LLM ë‹µë³€ ìƒì„± â†’ TTS                              â”‚
â”‚   â”œâ”€ api_call  â†’ ì™¸ë¶€ API í˜¸ì¶œ â†’ LLM ê°€ê³µ â†’ TTS                   â”‚
â”‚   â”œâ”€ transfer  â†’ TTS ì•ˆë‚´ â†’ SIP í˜¸ ì „í™˜                           â”‚
â”‚   â””â”€ collect   â†’ ë©€í‹°í„´ ì •ë³´ ìˆ˜ì§‘                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. êµ¬í˜„ ë¡œë“œë§µ

| Phase | ë‚´ìš© | ë²”ìœ„ | ë‚œì´ë„ |
|-------|------|------|--------|
| **Phase 1** | VectorDB ìŠ¤í‚¤ë§ˆ í™•ì¥ + ì‹œë”© ë¡œì§ + `play_greeting()` 2-Phase êµ¬í˜„ | Backend + AI | ì¤‘ |
| **Phase 2** | Capability ì „ìš© Backend API (`/api/capabilities/*`) | Backend | ì¤‘ |
| **Phase 3** | Frontend `/capabilities` ì„œë¹„ìŠ¤ ê´€ë¦¬ í˜ì´ì§€ (CRUD + ìˆœì„œ + í† ê¸€) | Frontend | ì¤‘ |
| **Phase 4** | ê°€ì´ë“œ ë©˜íŠ¸ ë¯¸ë¦¬ë³´ê¸° + ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ | Frontend | ì†Œ |
| **Phase 5** | `response_type=transfer` â†’ SIP í˜¸ ì „í™˜ ì—°ë™ | Backend + SIP | ì¤‘ |
| **Phase 6** | `response_type=api_call` â†’ ì™¸ë¶€ API í˜¸ì¶œ í”„ë ˆì„ì›Œí¬ | Backend | ìƒ |
| **Phase 7** | `response_type=collect` â†’ ë©€í‹°í„´ ì •ë³´ ìˆ˜ì§‘ ëŒ€í™” | AI | ìƒ |

---

## 9. ê¸°ìˆ  ì°¸ê³ 

### 9.1 ì—…ê³„ ë ˆí¼ëŸ°ìŠ¤
- **Ada.cx Voice**: Greeting Builder + Transfer Call Block + End Call Block
- **Rasa Knowledge Base Actions**: object_type + attributes ìŠ¤í‚¤ë§ˆ, `ActionQueryKnowledgeBase`
- **AURA (2025)**: ìŒì„± ì—ì´ì „íŠ¸ + function-calling (calendar, email, search)
- **Stream RAG (2025)**: ìŒì„± ì¤‘ tool ì‚¬ìš© ì˜ˆì¸¡ â†’ ì§€ì—° 20% ê°ì†Œ

### 9.2 ChromaDB ì¿¼ë¦¬ íŒ¨í„´
- metadata pre-filter (`where` ì ˆ) â†’ vector search ìˆœì„œê°€ ìµœì 
- `where={"doc_type": "capability", "is_active": True}` â†’ HNSW ê²€ìƒ‰ ë²”ìœ„ ì¶•ì†Œ
- ChromaDB metadataëŠ” string, int, float, boolë§Œ ì§€ì› (list/dict ë¶ˆê°€ â†’ JSON stringìœ¼ë¡œ ì €ì¥)
